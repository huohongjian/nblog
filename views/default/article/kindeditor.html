{% extends "default/layout.html" %}

{% block title %} KindEditor {% endblock%}

{% block head %}
	<link rel="stylesheet" href="{{ baseURL }}/js/kindeditor/themes/default/default.css" />
	<link rel="stylesheet" href="{{ baseURL }}/js/kindeditor/plugins/code/prettify.css" />
	<style>
		html, body {margin: 0;}

		#editForm > p { margin: 8px 0;}
		#editForm img { width: 200px; height: 150px; }
		input[name=title],
		input[name=alias],
		input[name=caption],
		input[name=thumb],
		textarea {width:100%;}
		textarea[name=caption] {height: 60px;}
		select {width:90px;}
		
		.left-frame > form,
		.right-frame > div {margin: 10px;}

		.banner {padding: 10px; background: #990000; #438eb9;}
		.banner * { color: #ffffff; }
		.banner .title {font-weight: bolder; display: inline-block; text-align: center;}


	</style>
{% endblock %}

{% block header %}{% endblock %}

{% block main %}
	<div class="banner">
		<span class="a-1-1 d-1-4 f-1-5 title">添加/修改文章</span>
		<span><a href="{{ baseURL }}/"><i class="fa fa-home"> 首页</i></a></span>
	</div>
	
	<div class="flex">
		<div class="a-1-1 d-1-4 f-1-5 left-frame">
			<form id="editForm">
				<p>
					<label>
						状态：
						<select name="status">
							<option value="1">推荐</option>
							<option value="2" selected="selected">发表</option>
							<option value="3">隐藏</option>
							<option value="4">删除</option>
						</select>
					</label>
					<label class="float-right">
						类别：
						<select name="categoryid">
							<option value="1">综合</option>
						</select>
					</label>
				</p>
				<p><label>标题：<input name="title" type="text" value="{{ article.title }}"></label></p>
				<p><label>别名：<input name="alias" type="text" value="{{ article.alias }}"></label></p>
				<p><label>摘要：<textarea name="caption">{{ article.abstract }}</textarea></label></p>
				<p>
					<label>微缩图：</label>
					<label class="float-right">电子书格式：<input type="checkbox" name="isbook" /></label>
					<input type="text" name="thumb" placeholder="单击上传，尺寸200x150" readonly="true" />
				</p>
				<p class="text-center">
					<img id="thumbimg" src="{{ baseURL }}/images/freebsd.png" data-baseurl="{{ baseURL }}"  data-src="{{ baseURL }}/images/freebsd.png" />
				</p>
				<p>
					<input type="button" name="save" value="保存" class="float-right" />
				</p>

				<input type="text" name="articleid" value="{{ article.articleid }}" class="hide" />
			</form>
		</div>

		<div class="a-1-1 d-3-4 f-4-5 right-frame">
			<div>
				<textarea name="content" style="width:100%; height:550px; visibility:hidden;">
					{{ article.content }}
				</textarea>
			</div>
		</div>
	</div>
{% endblock %}

{% block footer %}{% endblock %}

{% block script %}
<script src="{{ baseURL }}/js/kindeditor/kindeditor-all-min.js"></script>
<script src="{{ baseURL }}/js/kindeditor/plugins/code/prettify.js"></script>
<script type="text/javascript">
	var editor;
	KindEditor.ready(function(K) {
		editor = K.create('textarea[name="content"]', {
			cssPath : 			'../../../js/kindeditor/plugins/code/prettify.css',
			uploadJson : 		'../../../js/kindeditor/php/upload_json.php',
			fileManagerJson : 	'../../../js/kindeditor/php/file_manager_json.php',
			allowFileManager : true,
			cssData: 'body {font-family:"微软雅黑"; font-size:18px;}',
		});
		prettyPrint();

//		K('#image1').click(function() {
		K('input[name=thumb]').click(function() {
			editor.loadPlugin('image', function() {
				editor.plugin.imageDialog({
					imageUrl : K('input[name=thumb]').val(),
					clickFn : function(url, title, width, height, border, align) {
						K('input[name=thumb]').val(url);
						editor.hideDialog();

						var img = R.id('thumbimg');
						img.src = img.dataset.baseurl + url;
					}
				});
			});
		});

		K('input[name=save]').click(save);
	});




	R.enterMove();
	var articleid = R('[name="articleid"]').value;

	function save() {

		R.post("../save", R.fd('#editForm',{
	//		image: R.id('thumb').src.match(/\/images.*/),
			content: editor.html(),
			articleid: articleid,
		}), function(r){
			if (r.status == 200) {
				articleid = r.articleid;
				panelMsg(articleid);
				
			}
	//		message(r.msg, 1000);
		}, 'JSON');


	}
</script>
{% endblock %}