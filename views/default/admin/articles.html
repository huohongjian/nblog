{% extends "admin/layout.html" %}




{% block inRight %}
<h3>文档管理</h3>

<form id="searchForm" class="inline-block mr50">
	<select name="manageid"  onchange="getArticles(1)">
		<option value="">-- 所有管理状态 --</option>
		<option value="1">站长推荐</option>
		<option value="2">正常公开</option>
		<option value="3">限制浏览</option>
	</select>

	<select name="status" onchange="getArticles(1)">
		<option value="">-- 所有状态 --</option>
		<option value="公开">公开</option>
		<option value="隐藏">隐藏</option>
		<option value="删除">删除</option>
	</select>
	
	<select name="category" onchange="getArticles(1)">
		<option value="">-- 所有类别 --</option>
		{% for category in categories %}
		<option value="{{category}}">{{category}}</option>
		{% endfor %}
		<option value="未分类">未分类</option>
	</select>

	<select name="range">
		<option value="title">标题</option>
		<option value="content">内容</option>
		<option value="username">贡献者</option>
	</select>
	<input type="text" name="key" placeholder="search">

	<input type="text" name="userid" value="" hidden="true"/>
	<input type="text" name="page" value="1" hidden="true"/>
</form>


<form name="setForm" class="inline-block">
	<select name="status">
		<option value="">-- 更改管理状态 --</option>
		<option value="1">站长推荐</option>
		<option value="2">正常公开</option>
		<option value="3">限制浏览</option>
		<option value="4">彻底删除</option>
	</select>

	<input type="button" name="" value="批量设定" onclick="dowork()">
</form>


<form id="checkForm">
	<table id="articleTable" class="article">
		<thead>
			<tr>
				<th><input type="checkbox" id="checkall"></th>
				<th>标题</th>
				<th>状态</th>
				<th>类别</th>
				<th>点击</th>
				<th>添加时间</th>
				<th>贡献者</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody id="articles">
		</tbody>
	</table>
</form>

<span class="" id="pagination" data-curpage='{{pages.curPage}}' data-totitem='{{pages.totItem}}' data-peritem="{{pages.perItem}}"></span>




{% endblock %}


{% block toBody %}
<script type="text/javascript" src="../../../own/Pagination.js"></script>
<script type="text/javascript">

R.id('section-1').checked = true;
R.CHK('[name=checkone]').to('#checkall');
R.ONE('[name=key]').enter(function(){getArticles(1)});
R.one('[name=key]').focus();




var pagination = new Pagination({
	container: 'pagination',
	perItem: 10,
	onclick: function(index){
		getArticles(index);
	},
});


function getArticles(page) {
	R('[name=page]').value = page;

	R.post('', R.fd('#searchForm'), function(data) {
		pagination.refresh(data.pages);

		var tbody = R.id('articles');
		tbody.innerHTML = '';
		var articles = data.articles;
		if (!articles) return;

		for (var i=0; i<articles.length; i++) {
			var ca = articles[i],
				tr = R.ce('tr');
			tbody.appendChild(tr);

			tr.appendChild(R.ce('td', {
				innerHTML: '<input type="checkbox" name="ids" value="' + ca[0] + '"/>'
			}));
			tr.appendChild(R.ce('td', {
				innerHTML: '<a href="../article/'+ca[0]+'">'+ca[1]+'</a>'
			}));
			tr.appendChild(R.ce('td', {innerHTML: ca[2]}));
			tr.appendChild(R.ce('td', {innerHTML: ca[3]}));
			tr.appendChild(R.ce('td', {innerHTML: ca[4]}));
			tr.appendChild(R.ce('td', {innerHTML: ca[5]}));
			tr.appendChild(R.ce('td', {innerHTML: ca[6]}));
			tr.appendChild(R.ce('td', {
				innerHTML: '<a href="../user/article/edit/' + ca[0] + '">编辑</a>'
			}));
		}
	}, 'json');
}


function dowork() {
	console.log(R.CHK('[name=checkone]').val());

	console.log(R.FD('#checkForm').json());

	alert('建设中');
}

</script>

{% endblock %}